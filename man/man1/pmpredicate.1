'\"macro stdmacro
.\"
.\" Copyright (c) 2016,2017 Red Hat.
.\" Copyright (c) 2000 Silicon Graphics, Inc.  All Rights Reserved.
.\" 
.\" This program is free software; you can redistribute it and/or modify it
.\" under the terms of the GNU General Public License as published by the
.\" Free Software Foundation; either version 2 of the License, or (at your
.\" option) any later version.
.\" 
.\" This program is distributed in the hope that it will be useful, but
.\" WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
.\" or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
.\" for more details.
.\" 
.\"
.TH PMPREDICATE 1 "PCP" "Performance Co-Pilot"
.SH NAME
\f3pmpredicate\f1 \- a simple performance metrics client filter
.\" literals use .B or \f3
.\" arguments use .I or \f2
.SH SYNOPSIS
\f3pmpredicate\f1
[\f3\-a\f1 \f2archive\f1]
[\f3\-h\f1 \f2host\f1]
[\f3\-n\f1 \f2pmnsfile\f1]
[\f3\-P\f1]
[\f3\-S\f1 \f2numsec\f1]
[\f3\-s\f1 \f2samples\f1]
[\f3\-t\f1 \f2interval\f1]
[\f3\-Z\f1 \f2timezone\f1]
[\f3\-z\f1]
[\f3\-j\f1 \f2json_prefixe\f1]
[\f3\-f\f1 \f2predicate\f1]
[\f3\-r\f1 \f2rank\f1]
[\f3\-m\f1 \f2metric\f1]
[\f3\-d\f1 \f2directory\f1]
.SH DESCRIPTION
.B pmpredicate
is a simple client that reads a set of metrics which it filters
based on a predicate and the optional rank operation.  It
limits the results to the instances that have the predicate true and
optionally to some maximum number of instances with the highest
predicate values.  The results are stored JSON files useable by
.BR PMDADJSON(1) .
.PP
Normally
.B pmpredicate
operates on the distributed Performance Metrics Name Space (PMNS),
however if the
.B \-n
option is specified an alternative local PMNS is loaded from the file
.IR pmnsfile .
.PP
Unless directed to another host by the
.B \-h
option, or to an archive by the
.B \-a
option,
.B pmpredicate
will contact the Performance Metrics Collector Daemon (PMCD)
on the local host to obtain the required information.
The argument to
.B \-a
is a comma-separated list of names, each
of which may be the base name of an archive or the name of a directory containing
one or more archives.
The
.B \-a
and
.B \-h
options are mutually exclusive.
.PP
Other options control the specific information to be reported.
.TP
\f3\-P\f1
The default behavior for replaying a set of archives, is to replay at
full speed.  The
.B \-P
option may be used in conjunction with a set of archives, to request that
the prevailing real-time delay be applied between samples (see
.BR \-t )
to effect a pause.
.TP
\f3\-S\f1 \f2numsec\f1
The
.B \-S
option may be used in conjunction with a set of archives to request that
data collections start at the time
.I numsec
seconds from the start of the set of archives.
.TP
\f3\-s\f1 \f2samples\f1
The argument
.I samples
defines the number of samples to be retrieved and reported.
If samples is 0 or
.B \-s
is not specified,
.B pmpredicate
will sample and report continuously (in real time mode)
or until the end of the set of PCP archives (in archive mode).
.TP
\f3\-t\f1 \f2interval\f1
The default update \f2interval\f1 may be set to something other than the
default 5 seconds.
The
.I interval
argument follows the syntax described in
.BR PCPIntro (1),
and in the simplest form may be an unsigned integer (the implied
units in this case are seconds).
.TP
\f3\-j\f1 \f2json_prefix\f1
The json prefix for the set of metrics generated by pmpredicate
may be set to something other than the default of "prefix".
This allows multiple concurrent pmpredicate processes to run
without encountering a collision in PMNS.
.TP
\f3\-f\f1 \f2predicate\f1
Exactly one predicate metric is required by pmpredicate.  For the
predicate metrics instances with values greater than zero matching
each metric with metric with matching instances are included in the
JSON data.
.TP
\f3\-r\f1 \f2top\f1
By default all the metrics instances that the predicate matches will
be included in the JSON data.  The rank option limits the number of
instances to a maximum of \f2top\f1 items with the largest predicate
values.
.TP
\f3\-m\f1 \f2metric\f1
Each metric to filter with pmpredicate is specified with this option.
There must be at least one metric specified.
.TP
.TP
\f3\-d\f1 \f2directory\f1
By default
.B pmpredicate
creates a directory with the PID number in 
.IR $PCP_TMP_DIR/json
and writes the JSON files in the created directory.
A different directory to write the results can be specified with this option.
.PP
The output from
.B pmpredicate
is two JSON files: metadata.json and data.son.  These files are
useable by
.BR PMDADJSON(1) .
.IP + 3
The metadata.json describe the metrics names, units, and types.  It is written when the pmpredicate starts
.IP +
The data.json has the filtered data that and is periodically updated at the specified interval.
.PP
.SH FILES
.PD 0
.TP 10
.B $PCP_DEMOS_DIR/pmpredicate
source code, documentation, configuration files and Makefile
when the PCP development package is installed
.PD
.SH "PCP ENVIRONMENT"
Environment variables with the prefix
.B PCP_
are used to parameterize the file and directory names
used by PCP.
On each installation, the file
.I /etc/pcp.conf
contains the local values for these variables.
The
.B $PCP_CONF
variable may be used to specify an alternative
configuration file,
as described in
.BR pcp.conf (5).
.SH SEE ALSO
.BR PCPIntro (1),
.BR pmcd (1),
.BR pmchart (1),
.BR pmdumptext (1),
.BR pmgenmap (1),
.BR pminfo (1),
.BR pmdajson (1),
.BR pmrep (1),
.BR pmstat (1),
.BR pmval (1),
.BR PMAPI (3),
.BR pmFetchGroup (3),
.BR pcp.conf (5)
and
.BR pcp.env (5).
.SH DIAGNOSTICS
All are generated on standard error, and are intended to be self-explanatory.
