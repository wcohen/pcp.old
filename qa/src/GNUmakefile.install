#!gmake
#
# Copyright (c) 2012 Red Hat.
# Copyright (c) 2009 Aconex.  All Rights Reserved.
# Copyright (c) 1997-2002 Silicon Graphics, Inc.  All Rights Reserved.
#

ifdef PCP_CONF
include $(PCP_CONF)
else
include $(PCP_DIR)/etc/pcp.conf
endif
PATH	= $(shell . $(PCP_DIR)/etc/pcp.env; echo $$PATH)
include $(PCP_INC_DIR)/builddefs

# strip -I and -L options
#
TMP             := $(CFLAGS:-I%=)
CFLAGS          = $(TMP)
PCP_LIBS	=

CFLAGS		+= -I$(PCP_INC_DIR)
ifneq "$(PCP_LIB_DIR)" "/usr/lib"
# for ld add -L<run-time-lib-dir> and include -rpath when
# $(PCP_LIB_DIR) may not be on the default ld search path.
#
ifeq "$(PCP_PLATFORM)" "darwin"
PCP_LIBS	+= -L$(PCP_LIB_DIR) -Wl,-rpath $(PCP_LIB_DIR)
else
PCP_LIBS	+= -L$(PCP_LIB_DIR) -Wl,-rpath=$(PCP_LIB_DIR)
endif
endif

ifeq ($(shell test -f ../localconfig && echo 1), 1)
include ../localconfig
else
# Warning: ../localconfig does not exist, assuming PCP 3.0
PCP_VER=3000
endif
LDIRT += localconfig.h

include GNUlocaldefs

localconfig.h:
	@cd .. && ./mk.localconfig
	@awk -F= '{ print "#define",$$1,$$2 }' < ../localconfig > localconfig.h

install install_pcp:
